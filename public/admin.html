
<!DOCTYPE html>
<html>
<head>
  <title>Admin Dashboard</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body { background:#f4f6f9; }
    .nav-tabs .nav-link.active { background:#1f3c88; color:white; }
    .btn-primary { background:#1f3c88; border:none; }
  </style>
</head>

<body>

<div class="container mt-4">

  <div class="d-flex justify-content-between mb-3">
    <h3>RCA Admin Dashboard</h3>
    <a href="/logout" class="btn btn-danger btn-sm">Logout</a>
  </div>

  <ul class="nav nav-tabs">
    <li class="nav-item">
      <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#students">Students</button>
    </li>
    <li class="nav-item">
      <button class="nav-link" data-bs-toggle="tab" data-bs-target="#newstudent">New Student</button>
    </li>
  </ul>

  <div class="tab-content mt-3">

    <!-- STUDENTS TAB -->
    <div class="tab-pane fade show active" id="students">
      <table class="table table-bordered table-striped">
        <thead class="table-dark">
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Mobile</th>
            <th>Session</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="studentTable"></tbody>
      </table>
    </div>

    <!-- NEW STUDENT TAB -->
    <div class="tab-pane fade" id="newstudent">
      <div class="card p-4">
        <h5>Create New Student</h5>
        <form id="createForm">
          <input class="form-control mb-2" name="name" placeholder="Name" required>
          <input class="form-control mb-2" name="email" placeholder="Email" required>
          <input class="form-control mb-2" name="mobile" placeholder="Mobile">
          <input class="form-control mb-2" name="password" placeholder="Password" required>
          <input class="form-control mb-2" name="sessionid" placeholder="Session ID">
          <button class="btn btn-primary">Save</button>
        </form>
      </div>
    </div>

  </div>
</div>

<script>
async function loadStudents() {
  const res = await fetch('/api/students');
  const data = await res.json();

  let html = "";
  data.forEach(s => {
    html += `
      <tr>
        <td>${s.name}</td>
        <td>${s.email}</td>
        <td>${s.mobile || ''}</td>
        <td>${s.sessionid || ''}</td>
        <td>${s.isactive ? 'Active' : 'Inactive'}</td>
        <td>
          <button class="btn btn-warning btn-sm" onclick="toggle(${s.id})">
            ${s.isactive ? 'Deactivate' : 'Activate'}
          </button>
          <button class="btn btn-info btn-sm" onclick="resetPassword(${s.id})">
            Reset
          </button>
        </td>
      </tr>
    `;
  });

  document.getElementById('studentTable').innerHTML = html;
}

async function toggle(id) {
  await fetch('/api/students/' + id + '/toggle', { method:'PUT' });
  loadStudents();
}

async function resetPassword(id) {
  const newpassword = prompt("Enter new password:");
  if (!newpassword) return;

  await fetch('/api/students/' + id + '/reset', {
    method:'PUT',
    headers:{ 'Content-Type':'application/json' },
    body: JSON.stringify({ newpassword })
  });

  alert("Password Reset Successful");
}

document.getElementById('createForm').addEventListener('submit', async function(e){
  e.preventDefault();
  const formData = new FormData(this);

  await fetch('/api/students', {
    method:'POST',
    body: new URLSearchParams(formData)
  });

  alert("Student Created");
  this.reset();
  loadStudents();
});

loadStudents();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
